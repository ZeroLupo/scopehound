name = "scopehoundv3-worker"
main = "src/index.js"
compatibility_date = "2026-02-12"

# Cron trigger - runs every 6 hours (Scout: manual only, Operator: 9am+9pm, Command: all 4)
[triggers]
crons = ["0 3,9,15,21 * * *"]

# KV namespace for storing state
[[kv_namespaces]]
binding = "STATE"
id = "5f9d1d2230024aa0a2d49f441ba7ce5c"

# Workers AI binding (free tier)
[ai]
binding = "AI"

# Observability - persist logs to dashboard
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

# ─── SECRETS ────────────────────────────────────────────────────────────────
# Set via Cloudflare dashboard (Settings → Variables → Secrets) or wrangler CLI.
#
# SELF-HOSTED (required):
#   ADMIN_TOKEN          - protects config API and setup wizard
#
# SELF-HOSTED (optional):
#   SLACK_WEBHOOK_URL    - fallback if not set via setup wizard
#
# HOSTED MODE (set all 5 to activate auth + payments):
#   GOOGLE_CLIENT_ID     - Google OAuth client ID
#   GOOGLE_CLIENT_SECRET - Google OAuth client secret
#   STRIPE_SECRET_KEY    - Stripe secret key (sk_live_... or sk_test_...)
#   STRIPE_WEBHOOK_SECRET - Stripe webhook signing secret (whsec_...)
#   JWT_SECRET           - random string for signing session cookies
#
# HOSTED MODE (optional):
#   STRIPE_PRICE_IDS     - JSON mapping tier names to Stripe Price IDs
#                          e.g. {"scout_monthly":"price_xxx","scout_annual":"price_xxx","operator_monthly":"price_yyy","operator_annual":"price_yyy","command_monthly":"price_zzz","command_annual":"price_zzz"}
#
# AI (optional, enables AI-powered analysis — falls back to heuristics without it):
#   ANTHROPIC_API_KEY    - Anthropic API key (sk-ant-...) for Claude-powered analysis
#
# SLACK OAUTH (optional, enables "Add to Slack" button + slash commands):
#   SLACK_CLIENT_ID      - Slack app client ID
#   SLACK_CLIENT_SECRET  - Slack app client secret
#   SLACK_SIGNING_SECRET - Slack app signing secret (for verifying slash commands)
#
# AD LIBRARY (optional, enables /ads command with live Meta data):
#   META_APP_TOKEN       - Meta (Facebook) app access token with ads_library permission
#                          Without this, /ads still works but only generates search links
